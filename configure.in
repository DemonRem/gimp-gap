dnl Process this file with autoconf to produce a configure script.

AC_PREREQ(2.52)
AC_INIT(configure.in)
AM_CONFIG_HEADER(config.h)

GAP_MAJOR_VERSION=1
GAP_MINOR_VERSION=3
GAP_MICRO_VERSION=19
GAP_VERSION=$GAP_MAJOR_VERSION.$GAP_MINOR_VERSION.$GAP_MICRO_VERSION

VERSION=$GAP_VERSION

GETTEXT_PACKAGE=gimp20-gap
AC_SUBST(GETTEXT_PACKAGE)
AC_DEFINE_UNQUOTED(GETTEXT_PACKAGE, "$GETTEXT_PACKAGE",
                   [The gettext translation domain.])

AM_INIT_AUTOMAKE(gimp-gap, $VERSION)

AC_PROG_CC
AC_ISC_POSIX
AM_PROG_CC_STDC
AC_HEADER_STDC

ACLOCAL="$ACLOCAL $ACLOCAL_FLAGS"

AC_CHECK_HEADERS(unistd.h)
AC_CHECK_FUNCS(bind_textdomain_codeset)

AM_MAINTAINER_MODE

AM_PATH_GIMP_2_0(1.3.17, , AC_MSG_ERROR(Cannot find GIMP-2.0.))

dnl ## sourcecode for the MPEG decoder plug-in was removed
dnl Test for libmpeg
dnl AC_ARG_ENABLE(mpeg,
dnl               [  --disable-mpeg          don't build MPEG decoder plug-in])
dnl   if test "x$enable_mpeg" != "xno"; then
dnl   if test -z "$LIBMPEG"; then
dnl     AC_CHECK_LIB(mpeg, GetMPEGFrame,
dnl       [AC_CHECK_HEADER(mpeg.h,
dnl 	MPEG='mpeg'$EXEEXT; LIBMPEG='-lmpeg'; GAP_DECODE_MPEG='gap_decode_mpeg',
dnl 	[AC_MSG_WARN(*** MPEG plug-in will not be built (MPEG header file not found) ***)])],
dnl       [AC_MSG_WARN(*** MPEG plug-in will not be built (MPEG library not found) ***)])
dnl   fi
dnl   fi

AC_SUBST(GAP_DECODE_MPEG)

dnl Test for unix-frontends
AC_ARG_ENABLE(audiosupport,
              [  --disable-unix-frontends    don't build with UNIX specific frontends for xanim and mpeg encoders])
  if test "x$enable_unix_frontends" != "xno"; then
    GAP_UNIX_FRONTENDS='gap_frontends'
    AC_MSG_NOTICE(gimp-gap is configured with LINUX/UNIX specific frontends for xanim and mpeg encoders)
    AC_MSG_NOTICE(non LINUX/UNIX users should configure with  --disable-unix-frontends)
  else
    GAP_UNIX_FRONTENDS=''
    AC_MSG_WARN(*** the LINUX/UNIX specific frontends for xanim and mpeg encoders will NOT be built)
    AC_MSG_NOTICE(that is OK for non LINUX/UNIX users)
  fi

AC_SUBST(GAP_UNIX_FRONTENDS)

dnl Test for audiosupport
AC_ARG_ENABLE(audiosupport,
              [  --disable-audiosupport      don't build with audiosupport])
  if test "x$enable_audiosupport" != "xno"; then
    AC_CHECK_PROG(WAVPLAY_SERVER, wavplay, true, false)
    if $WAVPLAY_SERVER; then
      GAP_AUDIOSUPPORT='GAP_ENABLE_WAV_AUDIOSUPPORT'
    else
      GAP_AUDIOSUPPORT='GAP_ENABLE_WAV_AUDIOSUPPORT'
      AC_MSG_WARN(*** AUDIOSUPPORT will be compiled but will NOT WORK (because wavplay executable file was not found) ***)
      AC_MSG_WARN(*** For AUDIOSUPPORT the wavplay audioserver must be installed at runtime ***)
    fi
  else
      GAP_AUDIOSUPPORT='GAP_DISABLE_WAV_AUDIOSUPPORT'
  fi

  
AC_SUBST(GAP_AUDIOSUPPORT)

ALL_LINGUAS="az ca cs da de el en_GB es fi fr hr hu it ja ko lt ml nl nn no pl pt pt_BR ru sk sl sv tr uk zh_CN zh_TW"
AM_GLIB_GNU_GETTEXT

LOCALEDIR='${prefix}/${DATADIRNAME}/locale'

AC_PROG_RANLIB

dnl Use -Wall if we have gcc.
changequote(,)dnl
if test "x$GCC" = "xyes"; then
  case " $CFLAGS " in
  *[\ \	]-Wall[\ \	]*) ;;
  *) CFLAGS="$CFLAGS -Wall" ;;
  esac
fi
changequote([,])dnl

CPPFLAGS="$CPPFLAGS -DG_DISABLE_DEPRECATED -DGDK_DISABLE_DEPRECATED"

AC_SUBST(GAP_MAJOR_VERSION)
AC_SUBST(GAP_MINOR_VERSION)
AC_SUBST(GAP_VERSION)
	
AC_SUBST(LOCALEDIR)

AC_OUTPUT([
Makefile
images/Makefile
gap/Makefile
libwavplayclient/Makefile
po/Makefile.in
])
